<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECG Data</title>
</head>
<body>
    <h1>ECG Data</h1>
    <div id="ecgData">Waiting for ECG Data...</div>
    <button id="connectButton">Connect to ECG</button>
    <script>
      let device;
      let server;
      let service;
      let characteristic;

      // Request Bluetooth device with heart rate service
      async function connectBluetooth() {
        try {
          device = await navigator.bluetooth.requestDevice({
            filters: [{ services: ['0000180d-0000-1000-8000-00805f9b34fb'] }] // Full Heart Rate Service UUID
          });

          // Connect to the device and get the Heart Rate service
          server = await device.gatt.connect();
          service = await server.getPrimaryService('0000180d-0000-1000-8000-00805f9b34fb'); // Full Heart Rate Service UUID
          characteristic = await service.getCharacteristic('00002a37-0000-1000-8000-00805f9b34fb'); // Full Heart Rate Measurement Characteristic UUID

          characteristic.startNotifications();
          characteristic.addEventListener('characteristicvaluechanged', handleData);
        } catch (error) {
          console.log('Error:', error);
        }
      }

      // Handle incoming ECG data from Bluetooth
      function handleData(event) {
        // The ECG data is being sent as a uint8 value (ECG value)
        const ecgValue = event.target.value.getUint8(0);
        document.getElementById('ecgData').innerText = 'ECG: ' + ecgValue;
      }

      // Set up the button click event to trigger Bluetooth connection
      document.getElementById('connectButton').addEventListener('click', connectBluetooth);
    </script>
</body>
</html>
