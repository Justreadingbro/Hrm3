<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECG Data</title>
</head>
<body>
    <h1>ECG Data</h1>
    <div id="ecgData">Waiting for ECG Data...</div>
    <button id="connectButton">Connect to ECG</button>
    <script>
      let device;
      let server;
      let service;
      let characteristic;

      // Request Bluetooth device with specific services
      async function connectBluetooth() {
        try {
          device = await navigator.bluetooth.requestDevice({
            filters: [{ services: ['heart_rate'] }]
          });

          server = await device.gatt.connect();
          service = await server.getPrimaryService('heart_rate');
          characteristic = await service.getCharacteristic('heart_rate_measurement');
          
          characteristic.startNotifications();
          characteristic.addEventListener('characteristicvaluechanged', handleData);
        } catch (error) {
          console.log('Error:', error);
        }
      }

      // Handle incoming data from Bluetooth device
      function handleData(event) {
        const data = event.target.value.getUint8(0); // ECG data is received as uint8
        document.getElementById('ecgData').innerText = 'ECG: ' + data;
      }

      // Set up the button click event to trigger Bluetooth connection
      document.getElementById('connectButton').addEventListener('click', connectBluetooth);
    </script>
</body>
</html>
